<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Activity Logs | Inventory Portal</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');
        
        :root {
            --primary: #0f172a;
            --accent: #0081ff;
            --border-main: #94a3b8;
        }

        body {
            margin: 0; font-family: 'Inter', sans-serif;
            background: url('images.jpeg') no-repeat center center fixed;
            background-size: cover;
            min-height: 100vh;
        }

        body::before {
            content: ""; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(241, 245, 249, 0.92); z-index: -1;
        }

        .navbar { 
            height: 64px; background: var(--primary); color: white;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 24px; position: sticky; top: 0; z-index: 1000;
        }

        .back-btn { 
            background: rgba(255,255,255,0.1); border: 1.5px solid rgba(255,255,255,0.3); 
            color: white; padding: 8px 16px; border-radius: 6px; cursor: pointer;
            font-size: 0.85rem; font-weight: 600;
        }

        .container { padding: 40px 24px; max-width: 1100px; margin: 0 auto; }

        /* SEARCH & FILTER BAR */
        .filter-section {
            background: white; padding: 20px; border-radius: 12px;
            border: 2px solid var(--primary); margin-bottom: 30px;
            display: flex; gap: 15px; flex-wrap: wrap;
        }

        .filter-section input, .filter-section select {
            padding: 10px; border: 1.5px solid var(--border-main);
            border-radius: 6px; font-weight: 500;
        }

        /* LOG TABLE */
        .log-card {
            background: white; border-radius: 12px; overflow: hidden;
            border: 2px solid var(--primary); box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1);
        }

        table { width: 100%; border-collapse: collapse; text-align: left; }
        th { background: #f8fafc; padding: 15px; font-size: 0.75rem; font-weight: 800; color: #64748b; text-transform: uppercase; border-bottom: 2px solid #e2e8f0; }
        td { padding: 15px; border-bottom: 1px solid #e2e8f0; font-size: 0.9rem; color: var(--primary); font-weight: 500; }

        /* ACTION BADGES */
        .badge {
            padding: 4px 10px; border-radius: 6px; font-size: 0.7rem; font-weight: 800; text-transform: uppercase;
        }
        .type-order { background: #fee2e2; color: #e11d48; }
        .type-receiving { background: #dcfce7; color: #10b981; }
        .type-transfer { background: #fef3c7; color: #d97706; }

        @media (max-width: 768px) {
            .hide-mobile { display: none; }
        }
    </style>
</head>
<body>

    <nav class="navbar">
        <button class="back-btn" onclick="location.href='dashboard.html'">‚Üê BACK TO DASHBOARD</button>
        <div style="font-weight: 800;">TRANSACTION LOGS</div>
    </nav>

    <main class="container">
        <div class="filter-section">
            <input type="text" id="search-log" placeholder="Search Reference ID or Item..." style="flex: 2;" oninput="filterLogs()">
            <select id="type-filter" onchange="filterLogs()" style="flex: 1;">
                <option value="ALL">All Movements</option>
                <option value="ORDER">Orders</option>
                <option value="RECEIVING">Receiving</option>
                <option value="TRANSFER">Transfers</option>
            </select>
        </div>

        <div class="log-card">
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Type</th>
                        <th>Reference ID</th>
                        <th>Item Description</th>
                        <th class="hide-mobile">Qty</th>
                        <th>Details</th>
                    </tr>
                </thead>
                <tbody id="log-table-body">
                    </tbody>
            </table>
        </div>
    </main>

    <script>
        const SUPABASE_URL = 'https://crruounuhtfzyssyhgcc.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNycnVvdW51aHRmenlzc3loZ2NjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEyMjc5NDgsImV4cCI6MjA4NjgwMzk0OH0.PMLb-8HZLdXUxXk2Jv0f836_YVWcaS3X2ezCvjfG6jg';
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        let allLogs = [];

        async function loadLogs() {
            // Note: This assumes you have an 'activity_logs' table in Supabase.
            // If you haven't created it yet, I can provide the SQL for it.
            const { data, error } = await _supabase
                .from('activity_logs') 
                .select('*')
                .order('created_at', { ascending: false });

            if (data) {
                allLogs = data;
                renderLogs(allLogs);
            }
        }

        function renderLogs(logs) {
            const body = document.getElementById('log-table-body');
            body.innerHTML = logs.map(log => {
                const badgeClass = `type-${log.type.toLowerCase()}`;
                const date = new Date(log.created_at).toLocaleDateString();
                
                return `
                    <tr>
                        <td>${date}</td>
                        <td><span class="badge ${badgeClass}">${log.type}</span></td>
                        <td style="font-family: monospace; font-weight: 700;">${log.reference_id}</td>
                        <td>${log.item_name}</td>
                        <td class="hide-mobile">${log.quantity}</td>
                        <td style="font-size: 0.8rem; color: #64748b;">${log.details || '-'}</td>
                    </tr>
                `;
            }).join('');
        }

        function filterLogs() {
            const searchTerm = document.getElementById('search-log').value.toLowerCase();
            const typeFilter = document.getElementById('type-filter').value;

            const filtered = allLogs.filter(log => {
                const matchesSearch = log.reference_id.toLowerCase().includes(searchTerm) || 
                                     log.item_name.toLowerCase().includes(searchTerm);
                const matchesType = typeFilter === "ALL" || log.type === typeFilter;
                return matchesSearch && matchesType;
            });
            renderLogs(filtered);
        }

        loadLogs();
    </script>
</body>
</html>